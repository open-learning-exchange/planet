{"views":{"by_section_and_id_and_date":{"map":"function (doc) {\n        if (doc.docType !== 'message' || !Array.isArray(doc.viewIn)) { return; }\n\n        payload = {\n          message: doc.message,\n          time: doc.time,\n          updatedDate: doc.updatedDate,\n          createdOn: doc.createdOn,\n          labels: doc.labels,\n          user: doc.user ? {\n            name: doc.user.name,\n            firstName: doc.user.firstName,\n            middleName: doc.user.middleName,\n            lastName: doc.user.lastName,\n            planetCode: doc.user.planetCode\n          } : null,\n          viewIn: doc.viewIn,\n          chat: doc.chat,\n          news: doc.chat && doc.news ? {\n            conversations: doc.news.conversations\n          } : null\n        }\n\n        doc.viewIn.forEach(function (v) {\n          if (v.section === 'community' || v.section === 'teams') {\n            emit(\n              [ v.section, v._id, doc.updatedDate ],\n              payload\n            );\n          }\n        });\n      }"}}}