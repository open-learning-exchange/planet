{"validate_doc_update":"function (newDoc, oldDoc, userCtx, secObj) {\r\n    function require(field) {\r\n      var errMessage = field + ' is required';\r\n      if (!newDoc[field]) {\r\n        throw { forbidden: errMessage };\r\n      }\r\n    }\r\n    function canWrite() {\r\n      var CAN_WRITE = false;\r\n      var writeAccess = ['_admin'];\r\n      if(secObj && secObj.admins && secObj.admins.names) {\r\n        CAN_WRITE = (secObj.admins.names.indexOf(userCtx.name) !== -1);\r\n      }\r\n      if(!CAN_WRITE && secObj && secObj.admins && secObj.admins.roles) {\r\n        writeAccess.concat(secObj.admins.roles);\r\n      }\r\n      for (var i = 0; (!CAN_WRITE && i < userCtx.roles.length); i++) {\r\n        if (writeAccess.indexOf(userCtx.roles[i]) !== -1) {\r\n          CAN_WRITE = true;\r\n        }\r\n      }\r\n      if(!CAN_WRITE) {\r\n        throw { forbidden: 'You have only read-only access' };\r\n      }\r\n    }\r\n    canWrite();\r\n    if (!newDoc) {\r\n      require('name');\r\n      require('adminName');\r\n      require('nationUrl');\r\n    }\r\n  }"}