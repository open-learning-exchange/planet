FROM ubuntu:xenial as builder
LABEL maintainer="dogi@ole.org,mutugiii@ole.org"

COPY docker/chat-api/crosscompile_chat_api.sh .
RUN bash ./crosscompile_chat_api.sh armv7 install

#####

FROM treehouses/node-tags:arm

RUN apk update ;\
    apk add --no-cache bash curl git jq ca-certificates;\
    mkdir -p /usr/local/lib/node_modules; \
    ln -s /usr/local/lib/node_modules/add-cors-to-couchdb/bin.js /usr/local/bin/add-cors-to-couchdb

COPY --from=builder /usr/lib/node_modules /usr/local/lib/node_modules

WORKDIR /root

CMD bash ./docker-entrypoint.sh
