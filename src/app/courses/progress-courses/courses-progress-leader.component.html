<mat-toolbar>
  <mat-toolbar-row>
    <a mat-icon-button (click)="navigateBack()">
      <mat-icon>arrow_back</mat-icon>
    </a>
    <span>
      {{ headingStart ? headingStart + ' ' : '' }}
      <ng-container *ngIf="selectedStep === undefined" i18n>Course Progress</ng-container>
      <ng-container *ngIf="selectedStep !== undefined" i18n>Test Progress</ng-container>
    </span>
    <span class="toolbar-fill"></span>
    <planet-selector *ngIf="planetCodes.length > 1" [planetCodes]="planetCodes" (selectionChange)="planetSelectionChange($event)"></planet-selector>
    <button mat-icon-button *ngIf="isMobile" (click)="showFiltersRow = !showFiltersRow">
      <mat-icon>filter_list</mat-icon>
    </button>
  </mat-toolbar-row>

  <mat-toolbar-row *ngIf="!isMobile">
    <!-- Desktop View: Full toolbar with export and reset buttons -->
    <mat-form-field *ngIf="submittedExamSteps?.length > 1" class="margin-lr-3">
      <mat-select i18n-placeholder placeholder="View Test Progress" [value]="selectedStep" (selectionChange)="onStepChange($event.value)">
        <mat-option *ngFor="let step of submittedExamSteps" [value]="step" i18n>
          {{ step.stepTitle || 'Step ' + (step.index + 1) }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <button mat-raised-button color="accent" *ngIf="selectedStep !== undefined" (click)="resetToFullCourse()" class="margin-lr-3" i18n>
      Show full course
    </button>
    <button mat-raised-button color="accent" *ngIf="chartData?.length" (click)="exportChartData()" class="margin-lr-3" i18n>
      Export
    </button>
  </mat-toolbar-row>

  <mat-toolbar-row *ngIf="isMobile && showFiltersRow">
    <!-- Mobile View: Buttons shown in a secondary row -->
    <mat-form-field *ngIf="submittedExamSteps?.length > 1" class="margin-lr-3">
      <mat-select i18n-placeholder placeholder="View Test Progress" [value]="selectedStep" (selectionChange)="onStepChange($event.value)">
        <mat-option *ngFor="let step of submittedExamSteps" [value]="step" i18n>
          {{ step.stepTitle || 'Step ' + (step.index + 1) }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <button mat-raised-button color="accent" *ngIf="selectedStep !== undefined" (click)="resetToFullCourse()" class="margin-lr-3" i18n>
      Show full course
    </button>
    <button mat-raised-button color="accent" *ngIf="chartData?.length" (click)="exportChartData()" class="margin-lr-3" i18n>
      Export
    </button>
  </mat-toolbar-row>
</mat-toolbar>

<div class="view-container view-full-height">
  <planet-courses-progress-chart *ngIf="chartData?.length; else noProgress" [label]="chartLabel" [inputs]="chartData" [height]="yAxisLength" [showAvatar]="true" (clickAction)="memberClick($event)" (changeData)="changeData($event)">
  </planet-courses-progress-chart>
  <ng-template #noProgress i18n>No Progress record available</ng-template>
</div>
