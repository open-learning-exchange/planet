name: Planet Builder

on: [push]

jobs:
  build:
    name: Planet build
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Docker login
        run: docker login -u ${{ secrets.DOCKERUSERNAME }} -p ${{ secrets.DOCKERAPIKEY }}

      - name: Prepare CI
        run: |
          DOCKER_ORG=rjpadilla
          DOCKER_REPO=planet-tags
          DOCKER_REPO_TEST=planet-test
          VERSION=$(jq '.version' package.json | sed -e 's/^"//' -e 's/"$//')
          BRANCH="${GITHUB_REF#refs/heads/}"
          COMMIT="${GITHUB_SHA::8}"
          REMOTE_MASTER_HASH=$(git ls-remote https://github.com/rjpadilla/planet.git | grep refs/heads/master | cut -f 1)
          LOCAL_HASH=$(git log -n 1 --pretty=format:"%H")
          env

